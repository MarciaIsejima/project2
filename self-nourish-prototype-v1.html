<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Recipe Search</title>

    <link rel="stylesheet" href="style.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  </head>

  <body>

      <h1>Recipe Search Prototype</h1>
      
      <div>
        <br>
        <label>Enter ingredients: </label><input type="search" id="searchField" value='rice'>
        <button id="searchButton">Search Database</button>
      </div>

      <div>
        <br>
        <label>Enter recipe ID: </label><input type="search" id="searchIDField" value='Coconut-Rice-2634753'>
        <button id="searchIDButton">Search Database</button>
      </div>

      <section id="results">

      </section>

    <script>

    //create nutrients list array
    var nutrientsArray = [
      { name: "fat", id: 'FAT', dvQuantity: 65, dvUnit: 'g' },
      { name: "saturated fat", id: 'FASAT', dvQuantity: 20, dvUnit: 'g' },
      { name: "trans fat", id: 'FATRN', dvQuantity: 20, dvUnit: 'g' },
      { name: "cholesterol", id: 'CHOLE', dvQuantity: 300, dvUnit: 'mg' },
      { name: "sodium", id: 'NA', dvQuantity: 2400, dvUnit: 'mg' },
      { name: "carbohydrate", id: 'CHOCDF', dvQuantity: 300, dvUnit: 'g' },
      { name: "fibre", id: 'FIBTG', dvQuantity: 25, dvUnit: 'g' },
      { name: "sugars", id: 'SUGAR', dvQuantity: 25, dvUnit: 'g' }, // 37.5g for men and 25g for women - American Heart Association
      { name: "protein", id: 'PROCNT', dvQuantity: 50, dvUnit: 'g' },
      { name: "vitamin A", id: 'VITA_IU', dvQuantity: 1000, dvUnit: 'RE' },
      { name: "vitamin C", id: 'VITC', dvQuantity: 60,  dvUnit: 'g' },
      { name: "calcium", id: 'CA', dvQuantity: 1100, dvUnit: 'mg' },
      { name: "iron", id: 'FE', dvQuantity: 14, dvUnit: 'mg' }
    ];

    $(document).ready(function()
    {

      var section = document.querySelector('section');


      $("#searchButton").on("click", function(e)
      {
        //captures search field
        var search =  encodeURIComponent($("#searchField").val());
        if(search === "") return;

        //build API search command
        var requestURL = 'http://api.yummly.com/v1/api/recipes?_app_id=54fce035&_app_key=14d9a1aa6dfd905115577804346a9746&q='+search+'&maxResult=20';
        var request = new XMLHttpRequest();
        request.open('GET', requestURL);
        request.responseType = 'text';
        request.send();
        request.onload = function()
        {
          var responseText = request.response; // get the string from the response
          var responseRecipeList = JSON.parse(responseText); // convert it to an object

          showRecipeList(responseRecipeList);

        };

      });

      $("#searchIDButton").on("click", function(e)
      {
        //captures search field
        var recipeID =  $("#searchIDField").val();
        if(recipeID === "") return;

        //build API search command
        var requestURL = 'http://api.yummly.com/v1/api/recipe/'+recipeID+'?_app_id=54fce035&_app_key=14d9a1aa6dfd905115577804346a9746';
        var request = new XMLHttpRequest();
        request.open('GET', requestURL);
        request.responseType = 'text';
        request.send();
        request.onload = function()
        {
          var responseText = request.response; // get the string from the response
          var responseRecipe = JSON.parse(responseText); // convert it to an object

          showRecipe(responseRecipe);

        };

      });

      function showRecipeList(recipeList)
      {

        $("#results").empty();
        var myH1 = document.createElement('h1');
        section.appendChild(myH1);
        myH1.textContent="Results: ";

        var myPara = document.createElement('p');
        myPara.textContent = 'Recipes found: ' + recipeList.matches.length;
        section.appendChild(myPara);
        
        // show results in unordered list
        var myUList = document.createElement('ul');
        section.appendChild(myUList);
        // for each recipe on the list
        for (i = 0, len = recipeList.matches.length, text = ""; i < len; i++)
        {
          let item = recipeList.matches[i];

          //get recipe name and ID
          let listContent = item.recipeName + "- Recipe id: " + item.id;
          //create list item
          var myListItem = document.createElement('li');

          myListItem.textContent = listContent;
          myUList.appendChild(myListItem);

          // //get item thumbnail image
          // var myItemImg = document.createElement('img');
          // myItemImg.setAttribute('src',item.smallImageUrls);
          // myListItem.appendChild(myItemImg);

        };

      };

      function showRecipe(recipe)
      {

        $("#results").empty();

        //show recipe name
        var myH1 = document.createElement('h1');
        section.appendChild(myH1);
        myH1.textContent=recipe.name;
        
        // show recipe picture
        var recipeImg = document.createElement('img')
        recipeImg.setAttribute("src", recipe.images[0].hostedLargeUrl);
        section.appendChild(recipeImg);

        // show list of ingredients
        var ingredientTitle = document.createElement('h2');
        ingredientTitle.textContent="Ingredients list (Total of servings: " + recipe.numberOfServings + "):"
        section.appendChild(ingredientTitle);

        var myUList = document.createElement('ul');
        section.appendChild(myUList);

        for (i = 0, len = recipe.ingredientLines.length, text = ""; i < len; i++)
        {
          let item = recipe.ingredientLines[i];
          let listContent = item;
          var myListItem = document.createElement('li');
          myListItem.textContent = listContent;
          myUList.appendChild(myListItem);
        };

        // show list of nutrients
        var NutrientTitle = document.createElement('h2');
        NutrientTitle.textContent="Nutrients list:";
        section.appendChild(NutrientTitle);

        var myUList2 = document.createElement('ul');
        section.appendChild(myUList2);

        // search each element in 'nutrientsArray' on the recipe and retrieves the quantity and unity
        for (i = 0, len = nutrientsArray.length, text = ""; i < len; i++) 
        {
          let item = nutrientsArray[i];
          let nutrient = recipe.nutritionEstimates.find(nutrient => nutrient.attribute == item.id);
          if (typeof nutrient !== "undefined") {
            let listContent = item.name + " - quantity per serving: " + nutrient.value + nutrient.unit.abbreviation;
            var myListItem = document.createElement('li');
            myListItem.textContent = listContent;
            myUList2.appendChild(myListItem);
          }

        };

        // show cooking time
        var cookingTimePara = document.createElement("p");
        cookingTimePara.textContent = "Cooking time: " + recipe.totalTime;
        section.appendChild(cookingTimePara);

      };

    });


    </script>
  </body>
</html>
